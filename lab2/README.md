# Lab 2
# Operating system security

You need to fetch the assignment from the Internet.
Login to the virtual machine and execute:

```
$ wget http://public.tel.fer.hr/sui/zadatak2.tar.gz
$ tar xf zadatak2.tar.gz
```

The homework consists of 4 parts:

## 1) Exploiting the server vulnerability
The crontab of the root user on the virtual machine is as follows:
```
    */5 * * * * /usr/local/bin/backup
```
Study the crontab specification and derive when the script is executed.
Study the contents of the script and exploit the script to add your user to the
`sudo` group. After successfully adding yourself to the `sudo` group, logout
and login to apply changes. That will enable you to execute commands with root
rights.

With the sudo command display the contents of the `/etc/sudoers` file:
```
    $ sudo cat /etc/sudoers
```
Search for the line that enables users from the sudo group to execute commands
with root rights.

You should explore the terms cron, crontab, sudo and sudoers on your own.

**NOTICE**: To simplify solving this assignment, check out the detailed information:
[SPOILER](http://public.tel.fer.hr/sui/spoiler.html).

## 2) Storing the user passwords on the Linux OS
You need to add a new user inside the virtual machine with the same password
as the sui user. This can be done with the `adduser` command:
```
    $ sudo adduser username
```
Fill in the necessary data and set the same password (`Internet1`) as the user
sui.

With the su command login as the new user and confirm that the password is the
same:
```
    $ su - username
```
Study the contents of the new lines (generated by `adduser`) in files `/etc/passwd`
and `/etc/shadow`. Explain the meaning of different fields in these files. Are the
lines for the user sui and the new user identical if their passwords are the same?
Explain. Which algorithm is used to hash the data concerning user passwords.

With the `mkpasswd` command you can create the same field as the one in the
`/etc/shadow` line concerning the new user. Write a command that does that.

## 3) User passwords dictionary attack
Execute the following command to check whether the John The Ripper tool is
installed on the virtual machine:
```
    $ sudo john
```
If the result of the command is:
```
    sudo: john: command not found
```
You need to install the john tool:
```
    $ sudo aptitude install john
```
The john tool needs to be executed with the sudo command, otherwise it will not
work.

The last part of the assignment is about user password security. In the folder
you have 5 files which names begin with pass:

```
    # ls pass*
    pass_MD5
    pass_SHA-256
    pass_SHA-256_weak
    pass_SHA-512
    pass_SHA-512_weak
```

Those files contain top 100 used passwords hashed with the `mkpasswd` command by
using different algorithms. With the help of the `john` (John the Ripper - JTR)
tool compare the password cracking speed for different algorithms.

How the files with the weak affix differ from the normal one?

**NOTE**: You probably won't succeed with cracking all the passwords. That is
because you don't have all the passwords in the dictionary of the `john` tool. To
add the missing word execute the following command as root:
```
    # echo rockyou >> /usr/share/john/password.lst
```

## 4) Malware static analysis
In this part of the assignment you need to statically analyze parts of the two
malware files:

```
    $ file malware*
    malware1: data
    malware2: data
```

You can use the command `strings` to analyze those files. Analyze the output of
the files and identify the possibilities of both malware files. What types of
malware are those files? Explain.

## Assignment results

You **need to send** the following data by email to
[sui@fer.hr](mailto:sui@fer.hr) after solving the assignment: 

- **report** on the subject in **PDF format** (should not exceed **800 words**)
  which contains the procedure that you used to solve the assigment along with
  answers to assignment questions
- list all of **successful commands** used to complete the assignment

## Tools for this assignment

- `sudo` - running commands with root rights.
- `adduser` - adding new users and adding users to a group.
- `su` - changing current user ID.
- `mkpasswd` - creating lines for /etc/shadow.
- `john` - tool for cracking bad user passwords.
- `passwd` - changing user passwords.
